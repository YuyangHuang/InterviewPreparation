#### 四层模型
- 应用层：Telnet | ftp | email 等
- 传输层：TCP | UDP 
- 网络层：IP | ICMP | IGMP
> ICMP: Internet Control Message Protocol，Internet控制报文协议。它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。
- 链路层：设备驱动程序及接口卡

![pic](../assets/Internet_model.png)


## 三次握手 & 四次挥手

- 参考[b站视频](https://www.bilibili.com/video/BV1bi4y1x7m5?t=748)


## TCP & UDP
### 都是传输层协议
### UDP: 
- 用户数据报协议
- 无连接协议（不需要三次握手，不会对数据报文进行任何拆分和拼接）
- 过程：
  - 发送端：应用层将数据传给传输层的UDP协议，**增加一个UDP头**，传给网络层
  - 接收端：与上相反
- 单播、多播、广播
  - 一对一、一对多、多对多、多对一
- 面向报文
  - 发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付IP层。UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。因此，应用程序必须选择合适大小的报文
  - 感觉像是，UDP的关键在于报文数据，“不合并、不拆分”使得报文被很好地保存原有结构，结合内存管理和程序设计角度，需要让报文的结构和内容适应设备与应用要求。

- 不可靠性
  - 针对无连接的特性
  - 不会备份数据
  - **没有拥塞控制**，即使网络条件不好，也会按照恒定速率发送数据 -> 丢包

- 优点：头部开销小（8字节）：Source Port(2B) + Destination Port(2B) + Length(2B) + Checksum(2B)

- 适用场景：实时性要求高的，如电话会议、某些游戏。


### TCP:
- 传输控制协议
- 面向连接
  - 三次握手
    - SYN
    - ACK + SYN
    - ACK
    - 中间也会设计到ack、seq的传输，参考上文提到的b站教程

  - 四次挥手
    - FIN(client)
    - ACK(server)
    - FIN(server)
    - ACK(client)
- 仅支持单播 - 一对一
- 可靠的
  - 对于可靠传输，判断丢包，误码靠的是TCP的段编号以及确认号。TCP为了保证报文传输的可靠，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据（假设丢失了）将会被重传。

- 面向字节流（合并、切分）
- 提供拥塞控制
  - 当网络出现拥塞的时候，TCP能够减小向网络注入数据的速率和数量，缓解拥塞
- 全双工通信
  - TCP允许通信双方的应用程序在任何时候都能发送数据，因为TCP连接的两端都设有缓存，用来临时存放双向通信的数据。当然，TCP可以立即发送一个数据段，也可以缓存一段时间以便一次发送更多的数据段（最大的数据段大小取决于MSS）

### 对比
| | UDP |	TCP |
|-- | -- | --|
| 是否连接 |	无连接 |	面向连接 |
| 是否可靠 |	不可靠传输，不使用流量控制和拥塞控制 | 可靠传输，使用流量控制和拥塞控制 |
| 连接对象个数 |	支持一对一，一对多，多对一和多对多交互通信|	只能是一对一通信|
|传输方式|	面向报文|	面向字节流|
|首部开销|	首部开销小，仅8字节|	首部最小20字节，最大60字节|
|适用场景|	适用于实时应用（IP电话、视频会议、直播等）|适用于要求可靠传输的应用，例如文件传输|


